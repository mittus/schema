<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="hall-schema-model.js"></script>
    <script type="text/javascript" src="hall-schema-view.js"></script>
    <script type="text/javascript" src="hall-schema-controller.js"></script>
    <script type="text/javascript" src="hall-schema-servise.js"></script>
    <script type="text/javascript" src="helpers.js"></script>
    <script type="text/javascript" src="scalable.js"></script>
    <script type="text/javascript" src="hall-schema.js"></script>
    <!--script type="text/javascript" src="image-preloader.js"></script-->

<style>
    .shadow {
        box-shadow: 3px 1px 1px #000;
        fill: #cccccc;
    }
</style>

<form action="/" id="change_performance">
    Загрузка по id расписания
    <input type="text" name="performance" value="">
    <button>Выполнить</button>
</form>
<div class="uk-container uk-container-expand">
    <script type="text/javascript">
        $(function() {
            $('#change_performance').submit(function(e) {
                e.preventDefault();
                const val = $(this).serializeArray()[0].value;

                if(hallSchema) {
                    console.log('Обновление схемы');
                    hallSchema.schemeId = val;
                } else {
                    console.log('Новая схема');
                    initSchema(val);
                } 
            });
        });

        var seatImages = {
            'standart': new Image(),
            'comfort': new Image(),
            'massage': new Image(),
            'sofa': new Image(),
            'bed': new Image(),
        };


        seatImages.standart.src = '/img/seats/standart.png';
        seatImages.comfort.src = '/img/seats/comfort.png';
        seatImages.massage.src = '/img/seats/massage.png';
        seatImages.sofa.src = '/img/seats/sofa.png';
        seatImages.bed.src = '/img/seats/bed.png';

        /*var images = [
            '/img/seats/standart.png',
            '/img/seats/comfort.png',
            '/img/seats/massage.png',
            '/img/seats/sofa.png',
            '/img/seats/bed.png',
        ];

        var ip = new ImagePreloader();
        ip.queue(images);

        ip.preload().then(function() {
            initSchema(defaultPerformanceId);
        });*/

        let hallSchema;
        let thisPerformanceId;

        var initSchema = function(id) {

            const root = document.getElementById('canvas-holder');
            hallSchema = new HallSchema();
            const scalable = new Scalable(root);

            hallSchema.schemeId = id;
            hallSchema._view._limit = 5;
            hallSchema._view._images = seatImages;
            thisPerformanceId = id;
            hallSchema.init(root);
            scalable.init();

            // setInterval(function(){
            //     hallSchema.schemeId = performanceId;
            // }, 10000);

        }

    </script>
    <div id="canvas-holder" style="width:100%; height: 100%;"></div>
    <div class="uk-text-center uk-margin-small-top">
        <a href="#" class="uk-icon-button mapControl" data-control="0" uk-icon="minus" uk-tooltip="Уменьшить схему">Минус</a>
        <a href="#" class="uk-icon-button mapControl" data-control="1" uk-icon="thumbnails" uk-tooltip="Вернуть в исходный вид">Сброс</a>
        <a href="#" class="uk-icon-button mapControl" data-control="2" uk-icon="plus" uk-tooltip="Увеличить схему">Плюс</a>
    </div>
</div>
</body>
</html>